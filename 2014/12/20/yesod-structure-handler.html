<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Структура Yesod-проекта: обработчики</title>
        
        <link rel="stylesheet" type="text/css" href="../../../css/default.css" />
        <link rel="icon" type="image/x-icon" href="../../../images/favicon.ico" />
    </head>
    <body>
        <div id="wrapper">
        <div id="wrapper_2">
        
        <div id="header">
            <div id="logo">
                <a href="http://blog.dshevchenko.biz" title="Домой">Д. Шевченко</a><span class="logo-note">Программист, исследователь, писатель</span>
            </div>
            <div id="navigation">
                <a href="http://dshevchenko.biz" title="К корневому сайту"><span id="root_link">cd /</span></a>
                <a href="http://blog.dshevchenko.biz/archive.html">АРХИВ</a>
                <a href="http://blog.dshevchenko.biz/tags.html">ТЕМЫ</a>
                <a href="http://blog.dshevchenko.biz/feed.xml">RSS</a>
            </div>
        </div>

        <div id="content">
            <h1>Структура Yesod-проекта: обработчики</h1>

            <div class="info">
    (2014, 12, 20)
</div>

<div id="tags_of_post">
    <a href="../../../tags/Yesod.html">Yesod</a>, <a href="../../../tags/Haskell.html">Haskell</a>
</div>

<div style="padding-top: 20px;"></div>

<p>Приветствую!</p>
<p>Сегодня мы продолжаем изучать структура Yesod-проекта. Пришла пора взглянуть на содержимое каталога <code>Handler</code>.</p>
<h2 id="ресурсы">Ресурсы</h2>
<p>Вспомним корневой маршрут, задаваемый в файле <code>config/routes</code>:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">/</span>       HomeR       GET POST</code></pre>
<p>Все <code>GET-</code> и <code>POST</code>-запросы, направленные к корневой странице нашего приложения, будут обработаны сущностью, называемой <code>HomeR</code>. И теперь пришла пора заглянуть в каталог <code>Handler</code>:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">Home.hs</span></code></pre>
<p>В этом каталоге расположены файлы, содержащие код наших обработчиков. Откроем файл <code>Home.hs</code> и взглянем на них:</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="kw">module</span> <span class="dt">Handler.Home</span> <span class="kw">where</span>

<span class="kw">import </span><span class="dt">Import</span>

<span class="ot">getHomeR ::</span> <span class="dt">Handler</span> <span class="dt">Html</span>
getHomeR <span class="fu">=</span> <span class="kw">do</span>
    <span class="fu">...</span>

<span class="ot">postHomeR ::</span> <span class="dt">Handler</span> <span class="dt">Html</span>
postHomeR <span class="fu">=</span> <span class="kw">do</span>
    <span class="fu">...</span></code></pre>
<p>В этом файле есть ещё кое-что, но я специально убрал это, чтобы мы сфокусировались на главном. Итак, ресурс <code>HomeR</code> представлен двумя обработчиками: <code>GET</code>-запросы принимает функция <code>getHomeR</code>, а <code>POST</code>-запросы - функция <code>postHomeR</code>. Обратите внимание: имена этих функций образованы от имени ресурса <code>HomeR</code> путём приписывания к нему префиксов <code>get</code> и <code>post</code> (как вы помните, имя Haskell-функции всегда начинается с маленькой буквы). Впрочем, сейчас мы не станем рассматривать тела этих функций, это тема для отдельного разговора.</p>
<p>Обратите также внимание на имя модуля <code>Handler.Home</code>. В Yesod-проектах принято, что имя модуля, содержащего код обработчиков для ресурса, совпадает с именем этого ресурса, за вычетом буквы <code>R</code>. Таким образом, ресурсу <code>HomeR</code> соответствует модуль <code>Handler.Home</code>, а, скажем, ресурсу <code>ContactsR</code> будет соответствовать модуль <code>Handler.Contacts</code>.</p>
<h2 id="иерархия">Иерархия</h2>
<p>Разумеется, файлы внутри каталога <code>Handler</code> могут располагаться в некой иерархии. В реальном проекте это значительно удобнее, нежели валить все файлы в одну кучу. Например, в моём проекте файлы, отвечающие за аутенификационные аспекты, расположены в отдельном подкаталоге, в частности:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">Handler/</span>
    <span class="kw">Authentication/</span>
        <span class="kw">Error.hs</span>
        <span class="kw">VerificationLetter.hs</span></code></pre>
<p>В этом случае модуль, отвечающий за обработку неудачной попытки залогиниться, называется <code>Handler.Authentication.Error</code>.</p>
<h2 id="ресурсы-по-умолчанию">Ресурсы по умолчанию</h2>
<p>В списке наших маршрутов присутствуют, в частности, вот эти два:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">/favicon.ico</span>    FaviconR    GET
<span class="kw">/robots.txt</span>     RobotsR     GET</code></pre>
<p>Первый возвращает наш любимый favicon, второй возвращает заметки для поисковых роботов. Помните содержимое каталога <code>config</code>? Там уже лежат файлы <code>favicon.ico</code> и <code>robots.txt</code>, вот они и возвращаются.</p>
<p>Но вы спросите, а где же определены соответствующие обработчики? Ведь для ресурса <code>HomeR</code> есть файл <code>Handler/Home.hs</code>, однако файлов <code>Handler/Favicon.hs</code> и <code>Handler/Robots.hs</code> мы не видим. А всё очень просто: соответствующие обработчики уже определены внутри нашего проекта.</p>
<p>Дело в том, что Yesod делает за нас кое-какие рутинные операции. Согласитесь, файлы <code>favicon.ico</code> и <code>robots.txt</code> нужны в любом веб-приложении. Ну а раз они нужны, Yesod создаёт их за нас автоматически. Нам остаётся только лишь заменить <code>config/favicon.ico</code> и подредактировать, при необходимости, содержимое <code>config/robots.txt</code>.</p>
<p>Ну что ж, первое знакомство с обработчиками прошло успешно. Разумеется, в следующих заметках мы узнаем о них ещё много интересного.</p>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'dshevchenko'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    

        </div>
        
        <div id="footer">
            <div id="social">
                <strong>let</strong> social = [<span id="twitter"><a href="https://twitter.com/dshevchenko_biz" title="Twitter">t</a></span>, <span id="googleplus"><a href="http://google.com/+DenisShevchenko" title="Google+">g+</a></span>, <span id="github"><a href="https://github.com/denisshevchenko" title="GitHub">g</a></span>, <span id="facebook"><a href="https://www.facebook.com/dshevchenko.biz" title="Facebook">f</a></span>, <span id="linkedin"><a href="https://www.linkedin.com/in/dshevchenkobiz" title="LinkedIn">in</a></span>]
            </div>
            <div id="hakyll_mark">
                Сайт создан с помощью <a href="http://jaspervdj.be/hakyll">Hakyll</a> и живёт на <a href="https://github.com/denisshevchenko/blog">GitHub</a>
            </div>
        </div>
        
        <div id="search_form">
            <script>
              (function() {
                var cx = '007697214108744450483:ccjauglh7ao';
                var gcse = document.createElement('script');
                gcse.type = 'text/javascript';
                gcse.async = true;
                gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
                    '//www.google.com/cse/cse.js?cx=' + cx;
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(gcse, s);
              })();
            </script>
            <gcse:search></gcse:search>
        </div>
        </div>
        </div>
    </body>
</html>
