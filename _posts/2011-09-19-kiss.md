---
layout: post
title: 'KISS: простой пример с циклом'
created: 1316414596
categories:
- c++
- kiss
---
<!--break-->
Итак, есть код:
<cpp>
struct notify_about_incorrect_packets{ /* ... */ };

typedef std::vector< int > packets_id;

class channel {
public:
    void try_send() const {
        packets_id ids;
        // Проверяем наличие ошибочных пакетов 
        // и сохраняем их идентификаторы в ids...
        notify_about_incorrect_packets{}( ids );
        // ...
    }
</cpp>
Итак, есть контейнер <strong>ids</strong>, в котором сохраняются идентификаторы ошибочных пакетов. Внутри функтора <strong>notify_about_incorrect_packets</strong> происходит уведомление об этом (идентификаторы выводятся в лог).

Разумеется в том случае, если ни одного ошибочного пакета нет (а чаще всего будет именно так), уведомлять о них не нужно. Значит, нужна проверка. Вот вариант кода функтора с проверкой:
<cpp>
struct notify_about_incorrect_packets {
    void operator()( const packets_id& ids ) const {
        if ( ids.empty() ) return;
        BOOST_FOREACH ( const auto id, ids ) {
            log() << "Incorrect packet detected, id " << id << end;
        }
    }
};
</cpp>
Долгое время я писал именно так. А потом задумался... Проверка... А нужна ли она вообще? Конечно же нет. Ведь если контейнер <strong>ids</strong> пустой, то ни одной итерации в цикле BOOST_FOREACH не произойдёт, и мы тут же вылетим из функторного оператора. Значит, проверка на <strong>empty()</strong> бессмысленна.

Да, это вопрос одной строчки, то есть экономия кода ничтожна. Да и само проверочное условие разве сложное само по себе? Нет, проще не придумаешь. Однако каждая if-конструкция, сколь бы простой она ни была - это логическое ветвление кода, то есть <em>усложнение</em> кода. А усложнять код - это нехорошо.

Будьте проще, друзья!
