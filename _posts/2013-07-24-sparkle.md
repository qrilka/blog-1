---
layout: post
title: 'Sparkle: давняя проблема и простое решение'
category: articles
tags: [Sparkle, OS X]
comments: true
share: true
---

Всё-таки автоматизация - это хорошо. Пользователям StrictCode не придётся вручную скачивать и устанавливать обновления, потому что за них это сделает открытый фрэймворк **<a href="http://sparkle.andymatuschak.org/">Sparkle</a>** (кстати, весьма известный в среде Mac-разработчиков). Устанавливаешь - и с этой минуты обновление происходит автоматически. Причём можно проверять обновление вручную (через пункт меню), а можно поставить флажок, чтобы приложение тихонько проверяло обновления при запуске.

Всё это хорошо, но я столкнулся с неожиданной проблемой. Проверяю обновление, приложение корректно читает appcast.xml, говорит, мол, есть обновление, я даю согласие, она качает - и вдруг ошибка:

**The update is improperly signed.**

Дело в том, что по соображениям безопасности обновление подписывается и проверяется парой ключей DSA. Просто и надёжно. И вот именно с этим подписыванием и возникает указанная проблема. Причём, как выяснилось, проблема сия проявилась уже 2 года назад.

Гугл помог. Оказывается, при новых версиях OS X необходимо использовать другой скрипт для генерации ключей (то есть не тот, который идёт в дистрибутиве Sparkle 1.5b6, а сторонний, который автор написал отдельно). Насколько я мог понять, разница лишь в том, что длина ключа теперь не 2048 байт, а 1024.

Вот ссылка на обсуждение этой проблемы: https://github.com/andymatuschak/Sparkle/issues/114.

А вот и ссылка на правильный скрипт: https://raw.github.com/andymatuschak/Sparkle/55eed9efd84c4a2163a3e2b86c8d9b68a243fb6b/generate_keys.rb.

Странно, почему автор до сих пор не указал всего этого в официальной Wiki по установке и использованию Sparkle...
