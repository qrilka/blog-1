<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content>
        <meta name="author" content="Денис Шевченко">
        <link rel="icon" href="../../../static/images/favicon.ico">

        <title>Haskell: собираем простейший проект</title>

        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">

        <link href="../../../static/css/default.css" rel="stylesheet">
        
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>

        <script>
          window.___gcfg = {
            lang: 'ru'
          };
        </script>

        <script src="https://apis.google.com/js/platform.js" async defer>
        </script>
    </head>

  <body>
    <div class="container">
        <nav class="navbar navbar-default navbar-fixed-top">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <div id="logo">
                <a class="navbar-brand" href="../../../" title="Домой">
                  Мысли и опыт
                </a>
              </div>
            </div>
            
            <div id="navbar" class="collapse navbar-collapse">
              <ul class="nav navbar-nav">
                <li><a href="../../../tags.html">Темы</a></li>
                <li><a href="../../../archive.html">Архив</a></li>
                <li><a href="../../../feed.xml">RSS</a></li>
              </ul>

              <ul class="nav navbar-nav navbar-right">
                <li><a href="http://dshevchenko.biz" target="_blank">root</a></li>
              </ul>
            </div>
          </div>
        </nav>

        <div id="content">
            <h1>Haskell: собираем простейший проект</h1>

<div class="row">
    <div class="col-xs-5 col-sm-5 col-md-4 col-lg-4">
        <div class="post-info">
            <strong>where</strong> date = "30 ноября 2013"<br />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tags = [<a href="../../../tags/Haskell.html">Haskell</a>, <a href="../../../tags/cabal.html">cabal</a>]
        </div>
    </div>

    <div class="col-xs-2 col-sm-2 col-md-4 col-lg-4"></div>
  
    <div class="col-xs-5 col-sm-5 col-md-4 col-lg-4">
        
    </div>
</div>

<p>За основу я взял хорошее пошаговое руководство с <strong><a href="http://www.haskell.org/haskellwiki/How_to_write_a_Haskell_program#Structure_of_a_simple_project">официального сайта</a></strong> Haskell, и снабдил его некоторыми пояснениями. Не пугайтесь, что дальше идёт довольно много текста, потому что фактических команд, которые вам нужно будет выполнить в терминале, всего несколько. Объём этой статьи обусловлен подробностью моих комментариев.</p>
<p>Итак, подразумевается, что у вас уже установлена <strong><a href="http://www.haskell.org/platform/">Haskell Platform</a></strong>. В составе этой самой платформы присутствует мощная утилита под названием <code>cabal</code>. Не знаю как вам, а мне это название напомнило о персонаже из кровопролитной игры Mortal Kombat по имени Kabal. Впрочем, не пугайтесь, утилита эта не станет набрасываться на вас с железными крюками. Фактически она представляет собою эдакий Haskell-овский <code>make</code>. На самом деле эта утилита весьма мощная и многогранная в своих возможностях, но на данный момент просто воспринимайте её как сборочную утилиту специально для Haskell-проектов.</p>
<p>Создаём папку под названием Haskell и заходим в неё. В ней мы должны создать один файл: main.hs. Это наш файл исходного кода, в нашем простейшем случае других файлов не будет.</p>
<p>Открываем этот файл и пишем в нём, например, это:</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="kw">import </span><span class="dt">System.Environment</span>
 
<span class="ot">main ::</span> <span class="dt">IO</span> ()
main <span class="fu">=</span> getArgs <span class="fu">&gt;&gt;=</span> print <span class="fu">.</span> haqify <span class="fu">.</span> head
 
haqify s <span class="fu">=</span> <span class="st">&quot;Haq! &quot;</span> <span class="fu">++</span> s</code></pre>
<p>Сохраняем, закрываем, а потом выполняем в терминале простую команду:</p>
<p><bash> cabal init </bash></p>
<p>В результате вы попадёте в интерактивный диалог, в ходе которого вам будет предложено ответить на несколько вопросов о вашем проекте:</p>
<p><bash> MacBook-Pro-Sevcenko:Haskell dshevchenko$ cabal init Package name? [default: Haskell] Package version? [default: 0.1.0.0] Please choose a license: * 1) (none) 2) GPL-2 3) GPL-3 4) LGPL-2.1 5) LGPL-3 6) BSD3 7) MIT 8) Apache-2.0 9) PublicDomain 10) AllRightsReserved 11) Other (specify) Your choice? [default: (none)] 7 Author name? Denis Shevchenko Maintainer email? me@dshevchenko.biz Project homepage URL? Project synopsis? Learn project Project category: * 1) (none) 2) Codec 3) Concurrency 4) Control 5) Data 6) Database 7) Development 8) Distribution 9) Game 10) Graphics 11) Language 12) Math 13) Network 14) Sound 15) System 16) Testing 17) Text 18) Web 19) Other (specify) Your choice? [default: (none)] What does the package build: 1) Library 2) Executable Your choice? 2 Include documentation on what each field means (y/n)? [default: n]</p>
<p>Guessing dependencies…</p>
<p>Generating LICENSE… Warning: unknown license type, you must put a copy in LICENSE yourself. Generating Setup.hs… Generating Haskell.cabal…</p>
<p>You may want to edit the .cabal file and add a Description field. </bash></p>
<p>В результате в вашей папке будут созданы несколько дополнительных файлов. Не знаю, почему, но с автоматическим генерированием файла LICENSE произошла проблемка. Как видим, мы получили предупреждение вида:</p>
<p><bash> Generating LICENSE… Warning: unknown license type, you must put a copy in LICENSE yourself. </bash></p>
<p>Совершенно непонятно, <em>что</em> не понравилось утилите, ведь я ввёл номер лицензии 7 (что соответствует лицензии MIT) и она это проглотила, но в итоге файл LICENSE в корневой папке проекта так и не появился. Но дабы не было противоречий, просто добавьте этот файл вручную (и можете оставить его пустым).</p>
<p>Как уже было упомянуто, в корневой папке проекта появились следующие важные файлы:</p>
<ul>
<li>
Setup.hs
</li>
<li>
Haskell.cabal
</li>
</ul>
<p>Первый нам не так интересен, потому что (в соответствии с официальным руководством) редактировать этот файл руками нам придётся очень редко. А вот второй файл весьма любопытен. Откроем его и посмотрим:</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">name<span class="fu">:</span>                <span class="dt">Haskell</span>
version<span class="fu">:</span>             <span class="fl">0.1</span><span class="fu">.</span><span class="fl">0.0</span>
synopsis<span class="fu">:</span>            <span class="dt">Learn</span> project
<span class="co">-- description:         </span>
license<span class="fu">:</span>             <span class="dt">MIT</span>
license<span class="fu">-</span>file<span class="fu">:</span>        <span class="dt">LICENSE</span>
author<span class="fu">:</span>              <span class="dt">Denis</span> <span class="dt">Shevchenko</span>
maintainer<span class="fu">:</span>          me<span class="fu">@</span>dshevchenko<span class="fu">.</span>biz
<span class="co">-- copyright:           </span>
<span class="co">-- category:            </span>
build<span class="fu">-</span><span class="kw">type</span><span class="fu">:</span>          <span class="dt">Simple</span>
cabal<span class="fu">-</span>version<span class="fu">:</span>       <span class="fu">&gt;=</span><span class="fl">1.8</span>

executable <span class="dt">Haskell</span>
  main<span class="fu">-</span>is<span class="fu">:</span>           main<span class="fu">.</span>hs            
  <span class="co">-- other-modules:       </span>
  build<span class="fu">-</span>depends<span class="fu">:</span>     base <span class="fu">==</span><span class="fl">4.6</span><span class="fu">.*</span></code></pre>
<p>Как видите, этот файл представляет собой некий аналог Makefile для системы cabal. Тут уже сохранены те самые значения, которые мы вводили в процессе вышеупомянутого диалога.</p>
<p>Обращаю ваше внимание на то, что в этом сгенерированном файле изначально строка:</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">  main<span class="fu">-</span>is<span class="fu">:</span></code></pre>
<p>закомментирована. Вам необходимо раскомментировать её и прописать имя файла, содержащего функцию main, в нашем случае это main.hs. Если вы этого не сделаете, получите ошибку вида:</p>
<p><bash> Error: No ‘Main-Is’ field found for executable Haskell </bash></p>
<p>Итак, после этого выполняем следующую простую команду в терминале:</p>
<p><bash> cabal configure </bash></p>
<p>В результате произойдёт конфигурирование проекта, то есть некая подготовка к фактической сборке. И тут нас ожидает следующая тонкость.</p>
<p>Обратите внимание на последнюю часть файла Haskell.cabal:</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">executable <span class="dt">Haskell</span>
  main<span class="fu">-</span>is<span class="fu">:</span>           main<span class="fu">.</span>hs            
  <span class="co">-- other-modules:       </span>
  build<span class="fu">-</span>depends<span class="fu">:</span>     base <span class="fu">==</span><span class="fl">4.6</span><span class="fu">.*</span></code></pre>
<p>Видите отступ в два пробела перед тремя последними строками? Оказывается, это не просто так. Если мы уберём этот отступ, то получим такую ошибку:</p>
<p><bash> cabal: Haskell.cabal:18: Construct not supported at this position: F 18 “main-is” “main.hs-depends: base ==4.6.*&quot; </bash></p>
<p>Кроме того, отступ должен быть никак не меньше двух пробелов, потому что ради эксперимента я пробовал поставить отступ из одного-единственного пробела, и получил уже такую ошибку:</p>
<p><bash> cabal: Haskell.cabal:18: Parse of field ‘main-is’ failed. </bash></p>
<p>В общем, два пробела. В этом случае конфигурирование пройдёт нормально.</p>
<p><bash> $ cabal configure Resolving dependencies… Configuring Haskell-0.1.0.0… </bash></p>
<p>После этого выполняем, собственно, команду сборки:</p>
<p><bash> $ cabal build Building Haskell-0.1.0.0… Preprocessing executable ‘Haskell’ for Haskell-0.1.0.0… </bash></p>
<p>Всё. После этого в нашей корневой папке проекта появилась папка <code>dist</code>. Вот её содержимое:</p>
<p><bash> dist/ ├── build │   ├── Haskell │   │   ├── Haskell &lt;&lt;—- Это и есть наш исполняемый файл. │   │   └── Haskell-tmp │   │   ├── Main.hi │   │   └── Main.o │   └── autogen │   ├── Paths_Haskell.hs │   └── cabal_macros.h ├── package.conf.inplace └── setup-config </bash></p>
<p>Ну вот собственно и всё. Можем запускать наше приложение:</p>
<p><bash> ./dist/build/Haskell/Haskell arg1 </bash></p>
<p>Вывод будет таким:</p>
<p><bash> “Haq! arg1” </bash></p>
<p>В дальнейшем я обязательно продолжу рассказы об утилите <code>cabal</code>, но главное, что теперь вы имеете представление о том, как в Haskell создать пусть и простейший, но уже реальный проект.</p>

<div id="socialButtons">
    <a href="https://twitter.com/share" class="twitter-share-button" data-lang="ru">Твитнуть</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

    <div class="g-plus" data-action="share" data-annotation="bubble"></div>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'dshevchenko'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    

        </div> 

        <div id="searchForm">
            <script>
              (function() {
                var cx = '007697214108744450483:ccjauglh7ao';
                var gcse = document.createElement('script');
                gcse.type = 'text/javascript';
                gcse.async = true;
                gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
                    '//www.google.com/cse/cse.js?cx=' + cx;
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(gcse, s);
              })();
            </script>
            <gcse:search></gcse:search>
        </div>

        <footer class="footer">
            Сайт работает на <strong><a href="http://jaspervdj.be/hakyll/" target="_blank">Hakyll</a></strong> и живёт на <strong><a href="https://github.com/denisshevchenko/blog" target="_blank">GitHub</a></strong>.
            <div class="copyright-note">
                Исходный код данного сайта, а также все опубликованные на нём материалы распространяются на условиях <a href="https://github.com/denisshevchenko/blog/blob/master/LICENSE" target="_blank">свободной лицензии MIT</a>.
            </div>
        </footer>
    </div>
  </body>
</html>

