---
title: OS X: новые сюрпризы для разработчика
tags: OS X
---

Столкнулся тут со странной проблемкой...

Style Revisor можно запустить как в консольном, так и в графическом режимах. Логика предельно проста: если запускаешь без аргументов командной строки, запускается графический режим, в противном случае - консольный.

Ну, думаю, всё просто:
```cpp
bool program_starts_in_GUI_mode( int const arguments_quantity ) {
    return 1 == arguments_quantity;
}

int main(   int   arguments_quantity
          , char* arguments[] ) {
    if( program_starts_in_GUI_mode(   arguments_quantity
                                    , arguments ) ) {
        QApplication application(   arguments_quantity
                                  , arguments );
        GUI::main_window a_main_window;
        a_main_window.show();
        return application.exec();
    }

    return console::runner{}(   arguments_quantity
                              , arguments );
}
```
Поскольку один аргумент (являющийся именем самой программы) присутствует всегда, я к этому и привязался.

А в процессе отладки я запускал приложение из командной строки, ну и всё прекрасно работало: если запускал так:
```cpp
$ Style\ Revisor.app/Contents/MacOS/Style\ Revisor
```
открывалось окно, если же так:
```cpp
$ Style\ Revisor.app/Contents/MacOS/Style\ Revisor -h
```
то продолжал работать в консоли.

А потом вдруг решил запустить в графическом режиме, причём "стандартным" способом: двойным кликом по иконке. То есть так, как будет запускать пользователь.

Кликаю - не запускается. Вернее, запускается и тут же вылетает. Ломаю голову, что же такое... А потом, в ходе экспериментов, оказалось, что количество передаваемых процессу аргументов при "стандартном" способе запуска равно 2. Не понял, подумал я, откуда там второй взялся-то? Решил поглядеть. В итоге вижу, что в качестве второго аргумента передаётся строка вида:
```cpp
-psn_0_3576681
```Ну а Гугл расставил всё на свои места. Оказывается, при "стандартном" запуске процессу передаётся (вторым обязательным аргументом) Process Serial Number (как я понял, аналог PID).

Так что вот... Всё-таки полезно на разных платформах поиграться...
