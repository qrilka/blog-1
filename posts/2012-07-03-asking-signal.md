---
title: Запрашивающий сигнал
tags: Qt, C++
---

Представим себе, что нам нужно обработать нажатие на кнопку в Qt. В этом случае сигнал клика связывается с обработчиком:
```cpp
connect(   button
         , SIGNAL( clicked() )
         , handler
         , SLOT( button_was_clicked() ) );
```
Здесь активная сторона (кнопка) *сообщает* посредством сигнала некой обрабатывающей стороне о событии нажатия. Но сигнал также можно использовать и для *запроса* данных **от** обрабатывающей стороны. Весьма полезная возможность, упрощающая код.

В Style Revisor есть кнопка **Go!**, запускающая процесс форматирования. Когда пользователь нажимает её, в обработчике клика происходит запрос к прочим виджетам с целью сбора информации о выбранном пользователем языке программирования, стиле форматирования и т.д (поскольку этой информацией обладают только эти виджеты и никто кроме них). Ну и по старой привычке я использовал (почти) канонический подход: на стадии инициализации внутри обработчика нажатия на эту кнопку я сохранял указатели на нужные виджеты, чтобы потом иметь возможность к ним обратиться, мол, какой там язык пользователь выбрал? Сигналы же я использовал исключительно для одностороннего оповещения о некотором действии пользователя. А теперь - не только...

Теперь я использую сигналы и для запроса данных от обрабатывающей стороны. Мысль предельно проста: если в качестве аргумента сигнала я могу передать нечто по **константной** ссылке, то могу и по **неконстантной**. А следовательно, можно получить это нечто от обрабатывающей стороны, а не только сообщить ей нечто.

Поэтому теперь я на стадии инициализации создаю "цепочку" из сигналов от запрашивающей стороны к ответчику, а потом запрашивающий сигнал идёт до ответчика, а тот, обрабатывая его, передаёт нечто через неконстантную ссылку вовне, то есть - к запрашивающей стороне. Всё просто.
```cpp
void start() {
    QString extensions;
    emit a_parent->obtain_filename_extensions( extensions );
    // А здесь в extensions уже лежит строка, полученная 
    // откуда-то извне, то есть от ответчика.
}
...
connect(   start
         , SIGNAL( obtain_filename_extensions( QString& /* where_to_place_it */ ) )
         , a_parent
         , SIGNAL( obtain_filename_extensions( QString& /* where_to_place_it */ ) ) );
...
// И так далее сигнал передаётся по цепочке до ответчика.
connect(   this
         , SIGNAL( obtain_filename_extensions( QString& /* where_to_place_it */ ) )
         , list
         , SLOT( obtain_filename_extensions( QString& /* where_to_place_it */ ) ) );
```
А ответчик уже кладёт в where_to_place_it нужную строку, которая имеется только у него.
